---
description: "Выполняет синхронизацию статусов User Stories в базе знаний с их реальным состоянием в Git, используя автоматизированные скрипты для анализа."
---

<task>
    <name>Аудит и Синхронизация Базы Знаний с Git</name>
    <objective>Автоматически выявить и устранить расхождения между статусами User Stories в Logseq и наличием закрывающих коммитов в Git.</objective>
    <trigger>По ручному запуску перед закрытием фазы или еженедельно.</trigger>
    <context>
        <tool_to_use>scripts/development/validate_kb.py</tool_to_use>
        <tool_to_use>scripts/development/sync_git_kb.py</tool_to_use>
        <source_of_truth>Логи Git-коммитов и файлы `STORY-*.md` в `pages/`.</source_of_truth>
        <standard>[[04-filename-referencing-rules]]</standard>
    </context>
    <workflow>
        <step id="1" name="Предварительная проверка целостности">
            <instruction>Делегировать агенту `Code`.</instruction>
            <sub_task_prompt>
"**Задача:** Перед началом синхронизации убедись, что база знаний не содержит базовых ошибок.
1.  Выполни команду: `python scripts/development/validate_kb.py`.
2.  Если скрипт находит ошибки, останови выполнение и сообщи мне о них. В противном случае, переходи к следующему шагу."
            </sub_task_prompt>
        </step>

        <step id="2" name="Анализ отчета и определение следующих шагов">
            <instruction>Проанализировать отчет валидации и определить дальнейшие действия.</instruction>
            <sub_task_prompt>
"**Задача:** Проанализируй `validation_report.log` и определи план.
1.  Прочитай файл `validation_report.log`.
2.  **Если в отчете есть ошибки типа 'Misplaced file'**:
    -   Сообщи мне об этом.
    -   Порекомендуй запустить команду `Интеграция Бродячих Файлов` для их исправления.
    -   **Не продолжай** выполнение текущей задачи, так как сначала нужно исправить расположение файлов.
3.  **Если есть другие ошибки (например, 'Broken link')**:
    -   Сформируй JSON-план для их исправления и запроси у меня подтверждение, как и раньше.
4.  **Если ошибок нет**:
    -   Сообщи, что проверка прошла успешно, и заверши задачу."
            </sub_task_prompt>
        </step>

        <step id="3" name="Автоматическое исправление статусов">
            <instruction>На основе отчета `sync_report.json` делегировать агенту `Code` задачу по исправлению статусов.</instruction>
            <sub_task_prompt>
"**Задача:** Исправь статусы в файлах User Story согласно отчету.
1.  Прочитай файл `sync_report.json`.
2.  Для **каждой** записи в отчете, открой указанный файл `STORY-*.md` и установи правильный статус (`status:: [[DONE]]` или `status:: [[TODO]]`) в соответствии с рекомендацией из отчета.
3.  После внесения всех исправлений, удали файл `sync_report.json`."
            </sub_task_prompt>
        </step>

        <step id="4" name="Финальный отчет">
             <instruction>Сообщить о завершении и сделать запись в журнале.</instruction>
             <sub_task_prompt>
"**Задача:** Заверши задачу и задокументируй результат.
1.  Сформируй краткий отчет о том, сколько User Stories было исправлено.
2.  Создай запись в журнале за сегодняшний день по стандарту `7.5. Journaling on Task Completion`."
             </sub_task_prompt>
        </step>
    </workflow>
</task>